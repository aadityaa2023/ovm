{% extends 'base.html' %}
{% load static %}

{% block title %}Server Error - OVM System{% endblock %}

{% block extra_css %}
<style>
    .error-container {
        min-height: 70vh;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        color: white;
        margin: 0 -15px;
        padding: 50px 15px;
    }
    
    .error-content {
        max-width: 600px;
    }
    
    .error-code {
        font-size: 8rem;
        font-weight: bold;
        background: linear-gradient(45deg, #fff, #f0f0f0);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        margin-bottom: 0;
        animation: glitch 1s infinite;
    }
    
    @keyframes glitch {
        0%, 100% { transform: translate(0); }
        20% { transform: translate(-2px, 2px); }
        40% { transform: translate(-2px, -2px); }
        60% { transform: translate(2px, 2px); }
        80% { transform: translate(2px, -2px); }
    }
    
    .error-message {
        font-size: 1.5rem;
        margin: 20px 0;
        opacity: 0.9;
    }
    
    .error-description {
        font-size: 1.1rem;
        margin-bottom: 30px;
        opacity: 0.8;
    }
    
    .error-actions {
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
    }
    
    .error-btn {
        display: inline-flex;
        align-items: center;
        padding: 12px 24px;
        background: rgba(255, 255, 255, 0.2);
        color: white;
        text-decoration: none;
        border-radius: 25px;
        font-weight: bold;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.3);
    }
    
    .error-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        color: white;
        text-decoration: none;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    
    .system-status {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 20px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .status-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .status-item:last-child {
        border-bottom: none;
    }
    
    .status-indicator {
        display: inline-flex;
        align-items: center;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 0.8em;
        font-weight: bold;
    }
    
    .status-ok {
        background: rgba(46, 204, 113, 0.3);
        color: #2ecc71;
    }
    
    .status-error {
        background: rgba(231, 76, 60, 0.3);
        color: #e74c3c;
    }
    
    .status-warning {
        background: rgba(243, 156, 18, 0.3);
        color: #f39c12;
    }
    
    .floating-errors {
        position: absolute;
        width: 100%;
        height: 100%;
        overflow: hidden;
        pointer-events: none;
    }
    
    .floating-error {
        position: absolute;
        color: rgba(255, 255, 255, 0.1);
        font-size: 1.5rem;
        animation: float-error 8s ease-in-out infinite;
    }
    
    @keyframes float-error {
        0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
        10% { opacity: 1; }
        90% { opacity: 1; }
        100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
    }
    
    .error-details {
        background: rgba(0, 0, 0, 0.2);
        border-radius: 8px;
        padding: 15px;
        margin: 20px 0;
        font-family: monospace;
        font-size: 0.9em;
        border-left: 4px solid rgba(255, 255, 255, 0.5);
    }
</style>
{% endblock %}

{% block content %}
<div class="error-container">
    <div class="floating-errors">
        <div class="floating-error" style="left: 10%; animation-delay: 0s;">500</div>
        <div class="floating-error" style="left: 30%; animation-delay: 2s;">ERROR</div>
        <div class="floating-error" style="left: 50%; animation-delay: 4s;">!</div>
        <div class="floating-error" style="left: 70%; animation-delay: 6s;">500</div>
        <div class="floating-error" style="left: 90%; animation-delay: 8s;">ERROR</div>
    </div>
    
    <div class="error-content">
        <h1 class="error-code">500</h1>
        <h2 class="error-message">Internal Server Error</h2>
        <p class="error-description">
            Something went wrong on our end. Our technical team has been automatically notified 
            and is working to fix this issue. Please try again in a few moments.
        </p>
        
        <div class="error-details">
            <strong>Error ID:</strong> ERR-{{ error_id|default:"OVM-500"|add:"-"|add:timestamp|default:"001" }}<br>
            <strong>Timestamp:</strong> <span id="error-timestamp"></span><br>
            <strong>User Agent:</strong> <span id="user-agent"></span>
        </div>
        
        <div class="system-status">
            <h5 class="mb-3">
                <i class="fas fa-server me-2"></i>
                System Status
            </h5>
            <div class="status-item">
                <span>Database Connection</span>
                <span class="status-indicator status-ok">
                    <i class="fas fa-check-circle me-1"></i>Online
                </span>
            </div>
            <div class="status-item">
                <span>Blockchain Network</span>
                <span class="status-indicator status-warning">
                    <i class="fas fa-exclamation-triangle me-1"></i>Degraded
                </span>
            </div>
            <div class="status-item">
                <span>Authentication Service</span>
                <span class="status-indicator status-error">
                    <i class="fas fa-times-circle me-1"></i>Error
                </span>
            </div>
            <div class="status-item">
                <span>File Storage</span>
                <span class="status-indicator status-ok">
                    <i class="fas fa-check-circle me-1"></i>Online
                </span>
            </div>
        </div>
        
        <div class="error-actions mt-4">
            <a href="javascript:location.reload()" class="error-btn">
                <i class="fas fa-sync-alt me-2"></i>
                Try Again
            </a>
            <a href="{% url 'index' %}" class="error-btn">
                <i class="fas fa-home me-2"></i>
                Go Home
            </a>
            <a href="javascript:reportError()" class="error-btn">
                <i class="fas fa-bug me-2"></i>
                Report Issue
            </a>
        </div>
    </div>
</div>

<div class="container my-5">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="card">
                <div class="card-header bg-danger text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        What happened?
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Possible Causes:</h6>
                            <ul class="list-unstyled">
                                <li class="mb-2">
                                    <i class="fas fa-server text-danger me-2"></i>
                                    Server maintenance or overload
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-database text-danger me-2"></i>
                                    Database connection issues
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-code text-danger me-2"></i>
                                    Application error in processing
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-network-wired text-danger me-2"></i>
                                    Network connectivity problems
                                </li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6>What you can do:</h6>
                            <ul class="list-unstyled">
                                <li class="mb-2">
                                    <i class="fas fa-clock text-info me-2"></i>
                                    Wait a few minutes and try again
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-sync text-info me-2"></i>
                                    Refresh the page
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-trash-alt text-info me-2"></i>
                                    Clear your browser cache
                                </li>
                                <li class="mb-2">
                                    <i class="fas fa-phone text-info me-2"></i>
                                    Contact technical support
                                </li>
                            </ul>
                        </div>
                    </div>
                    
                    <hr>
                    
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>For Voters:</strong> If this error occurs during voting, your vote has NOT been cast. 
                        Please try again once the system is restored. All votes are securely recorded on the blockchain.
                    </div>
                    
                    <div class="text-center mt-3">
                        <button class="btn btn-primary" onclick="checkSystemHealth()">
                            <i class="fas fa-heartbeat me-2"></i>
                            Check System Health
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Set timestamp and user agent
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('error-timestamp').textContent = new Date().toLocaleString();
    document.getElementById('user-agent').textContent = navigator.userAgent.substring(0, 50) + '...';
});

function reportError() {
    const errorDetails = {
        timestamp: new Date().toISOString(),
        userAgent: navigator.userAgent,
        url: window.location.href,
        referrer: document.referrer
    };
    
    // In a real application, this would send error details to logging service
    alert('Error report generated:\n\n' + JSON.stringify(errorDetails, null, 2) + '\n\nThis would be sent to our technical team.');
}

function checkSystemHealth() {
    // Simulate health check
    const button = event.target;
    const originalText = button.innerHTML;
    
    button.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Checking...';
    button.disabled = true;
    
    setTimeout(function() {
        // Simulate health check results
        const healthStatus = Math.random() > 0.5 ? 'healthy' : 'degraded';
        
        if (healthStatus === 'healthy') {
            button.innerHTML = '<i class="fas fa-check-circle me-2"></i>System Healthy';
            button.className = 'btn btn-success';
            
            setTimeout(function() {
                if (confirm('System appears to be healthy now. Would you like to reload the page?')) {
                    location.reload();
                }
            }, 1000);
        } else {
            button.innerHTML = '<i class="fas fa-exclamation-triangle me-2"></i>Issues Detected';
            button.className = 'btn btn-warning';
        }
        
        setTimeout(function() {
            button.innerHTML = originalText;
            button.className = 'btn btn-primary';
            button.disabled = false;
        }, 3000);
    }, 2000);
}

// Auto-refresh system status every 30 seconds
setInterval(function() {
    // In a real implementation, this would ping the server for status
    console.log('Checking system status...');
}, 30000);

// Add some visual feedback for the error code
document.querySelector('.error-code').addEventListener('click', function() {
    this.style.animation = 'none';
    setTimeout(() => {
        this.style.animation = 'glitch 1s infinite';
    }, 100);
});
</script>
{% endblock %}